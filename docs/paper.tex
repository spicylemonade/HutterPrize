\documentclass[11pt]{article}
\usepackage[a4paper,margin=1in]{geometry}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{booktabs}
\usepackage{siunitx}
\usepackage{enumitem}
\title{A Robust Self-Extracting Baseline for enwik9: Reversible Transforms + ZLIB}
\author{HutterPrize Solver Authors}
\date{\today}
\begin{document}
\maketitle
\begin{abstract}
We deliver a correct, robust, and testable baseline for the Hutter Prize enwik9 challenge. The system implements a self-extracting archive with a reversible streaming transform layer (dictionary tokenization, space/newline/digit/hex run encoding, and 0x00 escape) and a zlib backend. We fix prior correctness issues by centralizing the dictionary and adding a versioned transform header (HPZT v2) with a dictionary checksum verified by the decoder. Per-transform flags are declared in the payload header and enforced during decoding. Verification includes unit-like round-trip tests, chunk-boundary cases, and full enwik9 reproduction. While zlib is not competitive with the state-of-the-art total size, this foundation is engineered for integrating a stronger backend.
\end{abstract}

\section{Format and Pipeline}
We build two executables: \texttt{comp} (compressor) and \texttt{archive} (self-extracting decompressor). The compressor writes:
\begin{enumerate}[noitemsep]
  \item a decompressor stub (the \texttt{archive} program logic),
  \item a payload (optionally transformed and then compressed), and
  \item an HPZ2 footer: magic, method, original size, payload size, CRC-32 of the original.
\end{enumerate}
If transforms are enabled, the payload starts with an HPZT header.

\paragraph{HPZT v2 Header.} Magic \texttt{HPZT}, version=2, a flags bitmask, padding, and a 32-bit little-endian checksum of the shared dictionary (including NUL separators). The decoder validates the checksum if the dictionary transform is enabled and rejects any token inconsistent with the declared flags. Unrecognized header versions degrade to passthrough.

\section{Reversible Transforms}
All transforms are streaming and strictly invertible:
\begin{itemize}[noitemsep]
  \item Dictionary tokenization: frequent XML/Wikitext substrings mapped to two-byte tokens (0x00, id). The dictionary is shared via a single header and checksummed.
  \item Space-run: runs of spaces $\ge 4$ encoded as 0x00, 0x80, len$-$4.
  \item Newline-run: runs of newlines $\ge 2$ encoded as 0x00, 0x81, len$-$2.
  \item Digit-run: runs of digits $\ge 3$ encoded as 0x00, 0x82, len$-$3, followed by the digit bytes.
  \item Hex-run: runs of hex digits [0--9A--Fa--f] $\ge 3$ encoded as 0x00, 0x83, len$-$3, followed by the run bytes.
  \item Escape: literal 0x00 encoded as 0x00, 0x00.
\end{itemize}
The compressor exposes \texttt{--transforms=LIST} to select any subset from \{dict, space, nl, digits, hex\}. The decoder enforces the bitmask to guarantee consistency.

\section{Correctness and Validation}
We corrected a prior bug (encoder/decoder dictionary skew) by centralizing the dictionary and introducing an HPZT v2 checksum guard. The verification script runs small round-trip tests (STORE and ZLIB) with transform ablations and chunk-boundary stress cases. It then executes the full enwik9 pipeline and validates bit-identity (size and CRC).

\section{Engineering Notes}
We load zlib dynamically (\texttt{dlopen}) with a STORE fallback; build scripts mark executables explicitly to avoid permission issues. The decoder treats unrecognized HPZT versions as no-header passthrough to avoid false positives. The code targets a single CPU core and modest memory.

\section{Limitations and Roadmap}
Deflate is not strong enough to beat the current record. To approach prize levels we plan to integrate a context-mixing backend (cmix-class) and expand reversible preprocessing (structural tagging, canonicalization, learned phrase models), keeping the decoder self-contained.

\section{Reproducibility}
Build with \texttt{bash build.sh}, produce \texttt{archive} via \texttt{./comp enwik9 archive}, decompress with \texttt{./archive}, and validate with \texttt{cmp enwik9 enwik9.out}. The repository includes scripts (\texttt{verify.sh}, \texttt{measure.sh}) and is licensed under an OSI-approved license.

\end{document}
