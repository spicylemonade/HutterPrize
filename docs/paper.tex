\documentclass[11pt]{article}
\usepackage[a4paper,margin=1in]{geometry}
\usepackage{hyperref}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{booktabs}
\usepackage{siunitx}
\usepackage{enumitem}
\title{Towards a New Hutter Prize Record on enwik9: System Design and Implementation}
\author{HutterPrize Solver Authors}
\date{\today}
\begin{document}
\maketitle
\begin{abstract}
Iteration 1 fixes a correctness bug by unifying the dictionary into a shared header used by both encoder and decoder, removing a duplicated token that caused token ID skew. We also extend the HPZT transform header to version~2 with a 32-bit checksum over the dictionary which the decoder verifies before transform decoding, preventing future skew. The reversible streaming transforms (dictionary tokenization, space/newline/digit run encoding, and 0x00 escaping) remain strictly invertible. The backend remains zlib (dynamic) with STORE fallback.
\end{abstract}

\section{Self-Extracting Format}
We concatenate a decompressor stub with a payload and an HPZ2 footer (magic, method byte, original size, payload size, CRC-32 of original). When transforms are enabled, the payload starts with an HPZT header, now version~2: \texttt{``HPZT''}, version=2, flags, and a 32-bit little-endian checksum over the shared dictionary (content and order). The decoder validates this checksum before decoding.

\section{Transforms}
\begin{itemize}[noitemsep]
  \item Dictionary tokenization: frequent XML/Wikitext substrings are replaced by two-byte tokens (0x00, id). The dictionary is defined once in \texttt{src/dict.h} and used by both encoder and decoder.
  \item Space-run encoding: runs of spaces of length $\ge 4$ are replaced by 0x00, 0x80, len$-$4.
  \item Newline-run encoding: runs of newlines of length $\ge 2$ are replaced by 0x00, 0x81, len$-$2.
  \item Digit-run encoding: runs of digits of length $\ge 3$ are replaced by 0x00, 0x82, len$-$3 followed by the digit bytes.
  \item Escape: literal 0x00 is encoded as 0x00, 0x00.
\end{itemize}
All transforms are streaming and strictly reversible; decoding is driven by a finite-state machine.

\section{Backend and CLI}
We use dynamic zlib (loaded at runtime) with STORE fallback. The compressor supports \texttt{--method=zlib|store} and \texttt{--no-transform} for ablations.

\section{Correctness and Guardrails}
The duplicate token in the encoder dictionary caused an ID shift; unifying the dictionary removes the skew. HPZT v2 carries a dictionary checksum (CRC-32 over NUL-terminated strings and dictionary size). The decoder rejects payloads whose checksum does not match the built-in dictionary, guarding against accidental drift.

\section{Roadmap}
Next iterations will add unit tests for transform round-trips (including chunk boundary cases), and integrate a stronger backend (context mixing or similar). We will also extend reversible structural transforms specific to Wikitext/XML.

\end{document}
